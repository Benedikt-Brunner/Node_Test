<html>

<head>
    <title>Player <%= PlayerId %>
    </title>
    <link rel="shortcut icon" type="image/x-icon" href="/site_favicon_16_1664892280095.ico" />
    <link rel="stylesheet" href="/DynPlayer.css">
</head>

<body onload=loadname()>
    <h1> <a id="header" href="/Players"></a> </h1>

    <div class="Table">
        <div class="outer" id="up-left" onclick= selectMode(1)>
            <span>Klassisch</span>
        </div>
        <div class="outer" id="up-right" onclick= selectMode(2)>
            <span>Blitz</span>
        </div>
        <div class="center" id="main"></div>
        <div class="outer" id="down-left" onclick= selectMode(3)>
            <span>Schnellschach</span>
        </div>
        <div class="outer" id="down-right" onclick= selectMode(4)>
            <span>C960</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6"></script>

    <script>


        let id = <%= PlayerId%>;
        let data;
        let name;
        let selected = 0;

        fetch(`/getData/${id}`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' },


        })
            .then(response => response.text())
            .then(text => JSON.parse(text))
            .then(players => {
                data = Object.values(players[0])
            })

        function loadname() {
            fetch('/getplayers/1', {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },

            })
                .then(response => response.text())
                .then(text => JSON.parse(text))
                .then(players => {
                    let arr = [...players]
                    arr.forEach(player => {
                        if (player.id == id) {

                            name = player.Name;
                        }

                    })
                    document.getElementById("header").innerHTML = name;
                })
        }



        function classicalGraph() {
            for (let i = 1; i < data.length; i++) {
                let obj = {};
                obj["Rating"] = parseInt(data[i].split(":")[0])
                obj["Monate"] = i
                arr.push(obj)
            }
            let center = document.getElementById("center");
            center.append(

                Plot.plot({
                    inset: 10,
                    y: { domain: [0, 3000] },
                    marks: [
                        Plot.frame({ fill: "#eaeaea" }),
                        Plot.gridY({ stroke: "#fff", strokeOpacity: 1 }),
                        Plot.gridX({ stroke: "#fff", strokeOpacity: 1 }),
                        Plot.line(arr, { x: "Monate", y: "Rating" })
                    ]
                }))
        }

        function selectMode(mode) {
            if(selected != 0){
                reset();
                return;
            }
            let classical = document.getElementById("up-left");
            let blitz = document.getElementById("up-right");
            let rapid = document.getElementById("down-left");
            let c960 = document.getElementById("down-right");

            if (mode == 1) {
                blitz.style.opacity = 0;
                rapid.style.opacity = 0;
                c960.style.opacity = 0;
            } else if (mode == 2) {
                classical.style.opacity = 0;
                rapid.style.opacity = 0;
                c960.style.opacity = 0;
            } else if (mode == 3) {
                classical.style.opacity = 0;
                blitz.style.opacity = 0;
                c960.style.opacity = 0;
            } else if (mode == 4) {
                classical.style.opacity = 0;
                blitz.style.opacity = 0;
                rapid.style.opacity = 0;
            }
            selected = 1;
        }

        function reset(){
            let classical = document.getElementById("up-left");
            let blitz = document.getElementById("up-right");
            let rapid = document.getElementById("down-left");
            let c960 = document.getElementById("down-right");
            classical.style.opacity = 1;
            blitz.style.opacity = 1;
            rapid.style.opacity = 1;
            c960.style.opacity = 1;
            selected = 0;
        }


    </script>

</body>

</html>